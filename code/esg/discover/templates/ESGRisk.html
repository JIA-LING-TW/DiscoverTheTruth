{% extends "base.html" %}
{% load static %}
{% block subtitle %}風險管理{% endblock subtitle %}

{% block selfcss %}
<link rel="stylesheet" href="{% static 'css/risk.css' %}">
{% endblock selfcss %}

{% block body %}
<div class="container mt-5">
    <h1 class="text-center mb-4">ESG 風險管理查詢系統</h1>

    <!-- 篩選表單 -->
    <form method="GET" class="mb-3 f33">
        <div class="row align-items-end">
            <!-- 報告年度 -->
            <div class="col-auto_risk">
                <label for="report_year" class="form-label1_risk">報告年度：</label>
                <select name="report_year" id="report_year" class="form-select_risk">
                    <option value="">全部</option>
                    <option value="2021" {% if selected_year == '2021' %}selected{% endif %}>2021</option>
                    <option value="2022" {% if selected_year == '2022' %}selected{% endif %}>2022</option>
                    <option value="2023" {% if selected_year == '2023' %}selected{% endif %}>2023</option>
                </select>
            </div>
    
            <!-- 相關議題風險 -->
            <div class="col-auto_risk">
                <label for="risk_topic" class="form-label1_risk">相關議題風險：</label>
                <select name="risk_topic" id="risk_topic" class="form-select_risk">
                    <option value="">全部</option>
                    <option value="water" {% if selected_topic == 'water' %}selected{% endif %}>水資源管理</option>
                    <option value="energy" {% if selected_topic == 'energy' %}selected{% endif %}>能源管理</option>
                    <option value="waste" {% if selected_topic == 'waste' %}selected{% endif %}>廢棄物管理</option>
                    <option value="carbon" {% if selected_topic == 'carbon' %}selected{% endif %}>碳排放管理</option>
                </select>
            </div>
    
            <!-- 公司代碼 -->
            <div class="col-auto_risk co_risk">
                <label for="company_id" class="company_code_risk">公司代號：</label>
                <input type="text" name="company_id" id="company_id" class="form-control_risk" placeholder="請輸入公司代碼" value="{{ company_id }}">
            </div>
    
            <!-- 查詢按鈕 -->
            <div class="col-auto_risk">
                <button type="submit" class="btn btn-success_risk">篩選</button>
            </div>
        </div>
    </form>
    
    
    <!-- 提示訊息 -->
    {% if message %}
        <p class="text-center text-danger">{{ message }}</p>
    {% endif %}

    <!-- 風險資料 -->
    <div class="container44">
        <div class="content44">
             <!-- 顯示 API 資料 -->
            {% for item in api_data %}
             <div class="block44">
                 <h2>股名 / 股號</h2>
                 <p>{{ item.company_name|default:"未知公司" }} {{ item.company_id|default:"無資料" }}</p>
             </div>
             <div class="block44">
                 <h2>公司基本資訊</h2>
                 <p>資本額：{{ item.capital|default:"無資料" }}</p>
                 <p>董事長：{{ item.chairman|default:"無資料" }}</p>
                 <p>總經理：{{ item.ceo|default:"無資料" }}</p>
             </div>
            {% endfor %}
            <!-- 顯示資料庫資料 -->
            {% for risk in risks %}
                <div class="block44">
                    <h2>漂綠偵測結果</h2>
                    {% comment %} <p>{{ risk.company_name|default:"未知公司" }} {{ risk.company_id|default:"無資料" }}</p> {% endcomment %}
                    <p class="greenwashing-label 
                    {% if risk.greenwashing_label == '無漂綠跡象' %}
                        blue-label
                    {% elif risk.greenwashing_label == '可能漂綠' %}
                        gray-label
                    {% else %}
                        default-label
                    {% endif %}
                ">
                    漂綠標籤：{{ risk.greenwashing_label|default:"未標示" }}
                </p>
                    <p>驗證取得：{{ risk.verification_status|default:"未驗證" }}</p>
                </div>
                <div class="block44">
                    <h2>偵測風險結果</h2>
                    <p class="risk-level {% if risk.risk_level == '高風險' %}red-level{% elif risk.risk_level == '中風險' %}yellow-level{% elif risk.risk_level == '低風險' %}green-level{% else %}default-level{% endif %}">
                        風險等級：{{ risk.risk_level|default:"未評估" }}
                    </p>
                    
                </div>                         
            {% endfor %}
        </div>
    </div>
    
    
    
</div>
{% endblock %}

{% comment %} <div class="container">
    <h1 class="title">{{ risk.company_name }}風險偵測結果</h1>

    <div class="content">
      <div class="block">
        <h2>股名 / 股號</h2>
        <p>{{ risk.company_name }} {{ risk.company_id }} </p>
      </div>
      <div class="block">
        <h2>公司基本資訊</h2>
        <p>資本額：259,350,309,920</p>
        <p>董事長：劉德音</p>
        <p>總經理：魏哲家</p>
      </div>
      <div class="block">
        <h2>包含此標的之ESG型ETF：</h2>
        <p>00692 富邦公司治理</p>
        <p>00850 元大台灣ESG永續</p>
      </div>
      <div class="block">
        <h2>主要經營業務：</h2>
        <p>依客戶之訂單與其提供之產品設計說明...</p>
      </div>
    </div>
  </div> {% endcomment %}

